name: Sync TV Logos to Gitee

on:
  schedule:
    - cron: '0 0 * * *'  # 每天UTC 00:00运行
  workflow_dispatch:      # 允许手动触发

env:
  GITEE_USERNAME: "tyrian9905"
  GITEE_TOKEN: "a74325e9ecd2a8f505b8cd8d9b7138a0"  # 替换为你的实际令牌
  SOURCE_URL: "https://raw.githubusercontent.com/fanmingming/live/main/tv/"
  TARGET_DIR: "tvlogo"

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
    - name: Sync TV Logos
      run: |
        # 基本配置
        USER="${{ env.GITEE_USERNAME }}"
        TOKEN="${{ env.GITEE_TOKEN }}"
        REPO_URL="https://${USER}:${TOKEN}@gitee.com/tyrian9905/iptv.git"
        WORK_DIR="/tmp/tv_work"
        
        # 创建临时目录
        rm -rf $WORK_DIR
        mkdir -p $WORK_DIR
        cd $WORK_DIR
        
        # 克隆Gitee仓库
        echo "克隆仓库..."
        git clone $REPO_URL
        cd iptv
        
        # 创建目标目录
        mkdir -p ${{ env.TARGET_DIR }}
        cd ${{ env.TARGET_DIR }}
        
        # 获取PNG文件列表（简单方法）
        echo "获取文件列表..."
        PNG_FILES="cctv1.png cctv2.png cctv3.png cctv4.png cctv5.png cctv6.png cctv7.png cctv8.png cctv9.png cctv10.png cctv11.png cctv12.png cctv13.png cctv14.png cctv15.png cctv16.png cctv17.png 北京卫视.png 湖南卫视.png 浙江卫视.png 江苏卫视.png 东方卫视.png 安徽卫视.png 重庆卫视.png 广东卫视.png 深圳卫视.png"
        
        # 下载文件
        echo "下载文件..."
        for file in $PNG_FILES; do
          echo "下载: $file"
          curl -s -L -o "$file" "${{ env.SOURCE_URL }}$file" || true
        done
        
        # 配置Git
        cd ..
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        
        # 提交
        git add .
        if git diff-index --quiet HEAD --; then
          echo "没有变化"
        else
          echo "提交更改..."
          git commit -m "自动同步TV Logo $(date '+%Y-%m-%d %H:%M:%S')"
          git push
          echo "同步完成"
        fi
        
    - name: 完成通知
      if: success()
      run: |
        echo "✅ 同步完成"
        echo "查看: https://gitee.com/tyrian9905/iptv/tree/main/tvlogo"
        
    - name: 失败通知
      if: failure()
      run: echo "❌ 同步失败"
