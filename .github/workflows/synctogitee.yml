name: Sync IPTV to Gitee

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  # å®šæ—¶è§¦å‘ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
  schedule:
    - cron: '0 4 * * *'
  # ä»£ç æ¨é€æ—¶è§¦å‘
  push:
    branches: [ main ]

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
    - name: ä¸‹è½½IPTVæ–‡ä»¶
      run: |
        # åˆ›å»ºæ–‡ä»¶å¤¹
        mkdir -p iptv
        
        # ä¸‹è½½æ–‡ä»¶
        echo "æ­£åœ¨ä¸‹è½½ IPTV æ–‡ä»¶..."
        curl -s -o iptv/gx.m3u https://raw.githubusercontent.com/Healer-sys/Home/main/iptv/gx.m3u
        
        # æ£€æŸ¥æ˜¯å¦ä¸‹è½½æˆåŠŸ
        if [ -s iptv/gx.m3u ]; then
          echo "âœ… ä¸‹è½½æˆåŠŸï¼æ–‡ä»¶å¤§å°: $(wc -l < iptv/gx.m3u) è¡Œ"
        else
          echo "âŒ ä¸‹è½½å¤±è´¥ï¼"
          exit 1
        fi
    
    - name: æ¨é€åˆ°Gitee
      run: |
        # é…ç½®Git
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        # å…‹éš†Giteeä»“åº“
        echo "å…‹éš†Giteeä»“åº“..."
        git clone https://oauth2:${{ secrets.a74325e9ecd2a8f505b8cd8d9b7138a0 }}@gitee.com/${{ secrets.tyrian9905 }}/${{ secrets.iptv }}.git gitee-repo
        
        cd gitee-repo
        
        # æ›´æ–°æ–‡ä»¶
        cp ../iptv/gx.m3u ./gx.m3u
        
        # æäº¤æ›´æ”¹
        git add gx.m3u
        git commit -m "ğŸ”„ è‡ªåŠ¨åŒæ­¥ $(date '+%Y-%m-%d %H:%M:%S')"
        
        # æ¨é€
        echo "æ¨é€åˆ°Gitee..."
        git push origin master
        
        echo "âœ… åŒæ­¥å®Œæˆï¼"
