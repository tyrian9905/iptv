name: Sync IPTV to Gitee

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 4 * * *'  # æ¯å¤©å‡Œæ™¨4ç‚¹

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
    - name: ä¸‹è½½IPTVæ–‡ä»¶
      run: |
        curl -s -o gxmobile.m3u https://raw.githubusercontent.com/Healer-sys/Home/main/iptv/gx.m3u

    - name: æ¨é€åˆ°Gitee
      run: |
        # è®¾ç½®å˜é‡
        USER="tyrian9905"    # â† ç”¨æˆ·å
        REPO="iptv"        # â† ä»“åº“å
        TOKEN="a74325e9ecd2a8f505b8cd8d9b7138a0"      # â† Token
        
        # é…ç½®Git
        git config --global user.name "Auto Sync"
        git config --global user.email "auto@sync.com"
        
        # å…‹éš†ä»“åº“
        git clone https://oauth2:${TOKEN}@gitee.com/${USER}/${REPO}.git
        
        # è¿›å…¥ä»“åº“å¹¶æ›´æ–°æ–‡ä»¶
        cd ${REPO}
        cp ../gxmobile.m3u ./
        
        # æäº¤å¹¶æ¨é€
        git add gxmobile.m3u
        git commit -m "åŒæ­¥ $(date '+%Y-%m-%d %H:%M')"
        git push origin master
        
        echo "ğŸ‰ åŒæ­¥æˆåŠŸï¼"
        echo "è®¿é—®åœ°å€: https://gitee.com/${USER}/${REPO}/raw/master/gxmobile.m3u"
