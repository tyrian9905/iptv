name: 更新EPG节目单至cnb

on:
  workflow_dispatch:  # 手动触发
  schedule:
  # 北京时间凌晨2点 = UTC时间前一天18点
  - cron: '15 16,18,20,22,0,2,4,6,8,10,12,14 * * *'

jobs:
  fetch-ppxml:
    runs-on: ubuntu-latest
    steps:
      # 步骤1：下载外部URL的pp.xml文件
      - name: Download ppxml
        run: |
          curl -o ppxml https://epg.112114.xyz/pp.xml
          # 可选：验证文件是否存在（避免下载失败）
          if [ ! -f "ppxml" ]; then
            echo "下载失败：ppxml文件未找到"
            exit 1
          fi

      # 步骤2：拉取/推送文件到CNB仓库
      - name: Push to CNB
        env:
          CNB_TOKEN: ${{ secrets.CNB_TOKEN }}  # 使用GitHub Secrets中的令牌
        run: |
          # 进入CNB仓库目录（假设本地有该仓库，或通过git clone临时获取）
          cd /path/to/cnb-repo  # 替换为你的CNB仓库本地路径
          
          # 拉取目标目录下的文件（避免覆盖已有文件）
          git pull origin tyrian9905/work || true  # 若目录不存在，可能报错，忽略
          
          # 将新文件添加到暂存区
          git add tyrian9905/work/ppxml
          
          # 提交并推送（需填写CNB仓库的提交信息）
          git commit -m "Auto push ppxml from external URL"
          git push origin tyrian9905/work
